<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="我的学习记录，部分资料来自网络"><title>Jenkins安装配置+部署SpringBoot | tt_study</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Jenkins安装配置+部署SpringBoot</h1><a id="logo" href="/.">tt_study</a><p class="description">我的学习记录，部分资料来自网络</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Jenkins安装配置+部署SpringBoot</h1><div class="post-meta">Mar 7, 2018<span> | </span><span class="category"><a href="/categories/Others/">Others</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Jenkins"><span class="toc-text">Jenkins</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#下载安装"><span class="toc-text">下载安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置"><span class="toc-text">配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#部署项目"><span class="toc-text">部署项目</span></a></li></ol></li></ol></div></div><div class="post-content"><h3 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h3><h4 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h4><p>官网<a href="https://jenkins.io/download/" target="_blank" rel="noopener">https://jenkins.io/download/</a></p>
<p>选择<a href="http://mirrors.jenkins.io/war-stable/latest/jenkins.war" target="_blank" rel="noopener">Generic Java package (.war)</a>使用wget下载war包</p>
<blockquote>
<p>wget <a href="http://mirrors.jenkins.io/war-stable/latest/jenkins.war" target="_blank" rel="noopener">http://mirrors.jenkins.io/war-stable/latest/jenkins.war</a></p>
</blockquote>
<p>后台运行起来</p>
<blockquote>
<p>nohup java -jar jenkins.war &amp;</p>
</blockquote>
<p>访问8080端口 进入jenkins初始化设置</p>
<p>第一次登录需要输入口令，在运行日志里(nohup.out)可以找到一串password</p>
<p>登录后选择 Install suggested plugins 安装官方推荐的插件</p>
<p>插件一次可能不能全部安装成功，可以点Retry再安装。直到全部安装成功</p>
<p>安装完后进入 Create First Admin User 页面，设置用户名密码，设置完后进入Jenkins主界面</p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><ul>
<li>系统管理 &gt; 插件管理 &gt; 可选插件</li>
</ul>
<p>选择Git和Maven Integration，Publish over SSH、SSH插件。已经安装的可以不用操作</p>
<ul>
<li>系统管理 &gt; 全局工具配置</li>
</ul>
<p>配置java、git、maven等需要用的</p>
<ul>
<li>配置ssh免登录</li>
</ul>
<p>在<strong>运行Jenkins的服务器</strong>上生成密钥对，输入<code>ssh-keygen -t rsa</code>命令后一路回车，出现矩形图像说明生成成功，在<code>~/.ssh/</code>下会有私钥<code>id_rsa</code>和公钥<code>id_rsa.pub</code>生成</p>
<p>将<code>id_rsa.pub</code>中的内容复制到<strong>应用服务器</strong>的<code>~/.ssh/</code>下的<code>authorized_keys</code>，可用以下命令完成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i id_rsa.pub 192.168.0.xx</span><br><span class="line">chmod 644 authorized_keys</span><br></pre></td></tr></table></figure>
<ul>
<li>配置Publish over SSH</li>
</ul>
<p>系统管理 &gt; 系统设置 &gt; 找到Publish over SSH</p>
<p>Passphrase 不用设置<br>Path to key 写上生成的ssh路径：<code>/root/.ssh/id_rsa</code></p>
<p>下面的SSH Servers是重点，新增一个<br>Name 随意起名代表这个服务，待会要根据它来选择<br>Hostname 配置<strong>应用服务器</strong>的地址<br>Username 配置<strong>应用服务器</strong>登陆用户名<br>Remote Directory 不填</p>
<p>填完后可以点test一下，返回success说明配置ok</p>
<h4 id="部署项目"><a href="#部署项目" class="headerlink" title="部署项目"></a>部署项目</h4><p>首页选择<strong>新建</strong>，输入项目名称，选择maven项目(如果没有安装maven插件，这里没有maven项目的选项)</p>
<p>勾选<strong>丢弃旧的构建</strong>，<em>保持构建的天数</em>和<em>保持构建的天数</em>自己选择填写</p>
<p>源码管理：选择自己的源码托管平台，我这边选择了Git，填好地址信息</p>
<p>构建环境：勾选“Add timestamps to the Console Output”，代码构建的过程中会将日志打印出来</p>
<p>Build：Goals and options输入<code>clean install -Dmaven.test.skip=true -Ptest</code>意思是：排除测试的包内容，使用后缀为test的配置文件</p>
<p>Post Steps：选Run only if build succeeds，点击<strong>Add post-build step</strong>，选择 Send files or execute commands over SSH：<br>Source files：target/myproject-web-0.0.1-SNAPSHOT.jar    #  项目jar包在 jenkins workspace中的相对路径 如果你是多pom项目 请到~/.jenkins/workspace/myproject下 找到jar的相对路径<br>Remove prefix：target/    # 去掉前缀<br>Remote directory：myproject/jenkins/    # 代码应用服务器的目录地址<br>Exec command：myproject/run.sh    # 应用服务器对应的脚本</p>
<p>来到<strong>应用服务器</strong>，创建文件~/myproject/run.sh，复制下面内容到run.sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">DATE=$(date +%Y%m%d%H%M%S)</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME PATH CLASSPATH</span><br><span class="line">JAVA_HOME=/usr/java/jdk1.8.0_151/</span><br><span class="line">PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$PATH</span></span><br><span class="line">CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib:<span class="variable">$CLASSPATH</span></span><br><span class="line">DIR=~/myproject</span><br><span class="line">JARFILE=myproject-web-0.0.1-SNAPSHOT.jar</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="variable">$DIR</span>/backup ];<span class="keyword">then</span></span><br><span class="line">   mkdir -p <span class="variable">$DIR</span>/backup</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$DIR</span></span><br><span class="line"></span><br><span class="line">ps -ef | grep <span class="variable">$JARFILE</span> | grep -v grep | awk <span class="string">'&#123;print $2&#125;'</span> | xargs <span class="built_in">kill</span> -9</span><br><span class="line">mv <span class="variable">$JARFILE</span> backup/<span class="variable">$JARFILE</span><span class="variable">$DATE</span></span><br><span class="line">mv -f jenkins/<span class="variable">$JARFILE</span> .</span><br><span class="line">chmod a+x <span class="variable">$JARFILE</span></span><br><span class="line">java -jar <span class="variable">$JARFILE</span> &gt; out.log &amp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ $? = 0 ];<span class="keyword">then</span></span><br><span class="line">        sleep 30</span><br><span class="line">        tail -n 50 out.log</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> backup/</span><br><span class="line">ls -lt|awk <span class="string">'NR&gt;5&#123;print $NF&#125;'</span>|xargs rm -rf</span><br></pre></td></tr></table></figure>
<p>这段脚本的意思是，kill之前在运行的jar包，备份旧的jar包，启动新的jar包，保留最新的5个删除其他的旧的jar包</p>
</div><div class="tags"><a href="/tags/SpringBoot/">SpringBoot</a><a href="/tags/Jenkins/">Jenkins</a></div><div class="post-nav"><a class="pre" href="/2018/03/09/Java相关/Redis进阶命令/">Redis进阶命令</a><a class="next" href="/2018/03/07/其他/各环境变量配置/">各环境变量配置</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var gitment = new Gitment({
  owner: 'wtksana',
  repo: 'wtksana.github.io',
  oauth: {
    client_id: '3337687b3c13cd764c2a',
    client_secret: '524f7e3efacf27d6614a5f2a9f623f8753a84eb5',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="wtksana.github.io"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java基础/">Java基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java相关/">Java相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/">Mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Others/">Others</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Centos/" style="font-size: 15px;">Centos</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/RabbitMQ/" style="font-size: 15px;">RabbitMQ</a> <a href="/tags/MQ/" style="font-size: 15px;">MQ</a> <a href="/tags/Mybatis/" style="font-size: 15px;">Mybatis</a> <a href="/tags/ZooKeeper/" style="font-size: 15px;">ZooKeeper</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/Jenkins/" style="font-size: 15px;">Jenkins</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Https/" style="font-size: 15px;">Https</a> <a href="/tags/IDEA/" style="font-size: 15px;">IDEA</a> <a href="/tags/VPS/" style="font-size: 15px;">VPS</a> <a href="/tags/SS/" style="font-size: 15px;">SS</a> <a href="/tags/协议/" style="font-size: 15px;">协议</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/IP/" style="font-size: 15px;">IP</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/03/29/Spring/SpringBoot 7.1.RabbitMQ进阶使用/">SpringBoot 7.1.RabbitMQ进阶使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/22/Spring/SpringBoot 7.整合RabbitMQ/">SpringBoot 7.整合RabbitMQ</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/20/Spring/SpringBoot 6.整合Redis和session/">SpringBoot 6.整合Redis Cache和session</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/19/Spring/SpringBoot 5.模块拆分/">SpringBoot 5.模块拆分</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/16/Spring/SpringBoot 4.过滤器、监听器、拦截器/">SpringBoot 4.过滤器、监听器、拦截器</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/15/Spring/SpringBoot 3.整合Mybatis/">SpringBoot 3.整合Mybatis</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/15/Spring/SpringBoot 2.继续完善/">SpringBoot 2.完善一下</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/14/Spring/SpringBoot 1.项目构建/">SpringBoot 1.项目构建</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/09/Mysql/Mysql用户相关/">Mysql用户相关</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/09/Java相关/Redis进阶命令/">Redis进阶命令</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">tt_study.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>
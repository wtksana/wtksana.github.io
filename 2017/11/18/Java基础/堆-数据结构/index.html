<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="我的学习记录，部分资料来自网络"><title>数据结构-堆 | tt_study</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">数据结构-堆</h1><a id="logo" href="/.">tt_study</a><p class="description">我的学习记录，部分资料来自网络</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">数据结构-堆</h1><div class="post-meta">Nov 18, 2017<span> | </span><span class="category"><a href="/categories/Java基础/">Java基础</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#堆的概念"><span class="toc-text">堆的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#完全二叉树"><span class="toc-text">完全二叉树</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编号与数组存储"><span class="toc-text">编号与数组存储</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#最大堆-最小堆"><span class="toc-text">最大堆/最小堆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#概念总结"><span class="toc-text">概念总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#堆的算法"><span class="toc-text">堆的算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#添加元素"><span class="toc-text">添加元素</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#从头部删除元素"><span class="toc-text">从头部删除元素</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#从中间删除元素"><span class="toc-text">从中间删除元素</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#构建初始堆"><span class="toc-text">构建初始堆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查找和遍历"><span class="toc-text">查找和遍历</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#小结"><span class="toc-text">小结</span></a></li></ol></li></ol></div></div><div class="post-content"><p><a href="https://juejin.im/post/582d0cd2a0bb9f0067a4535b" target="_blank" rel="noopener">原文链接</a></p>
<p>这里的堆指的是一种数据结构，堆可以非常高效方便的解决很多问题，比如说：</p>
<ul>
<li>优先级队列，我们之前介绍的队列实现类LinkedList是按添加顺序排队的，但现实中，经常需要按优先级来，每次都应该处理当前队列中优先级最高的，高优先级的，即使来得晚，也应该被优先处理。</li>
<li>求前K个最大的元素，元素个数不确定，数据量可能很大，甚至源源不断到来，但需要知道到目前为止的最大的前K个元素。这个问题的变体有：求前K个最小的元素，求第K个最大的，求第K个最小的。</li>
<li>求中值元素，中值不是平均值，而是排序后中间那个元素的值，同样，数据量可能很大，甚至源源不断到来。</li>
</ul>
<p>堆还可以实现排序，称之为堆排序，不过有比它更好的排序算法，所以，我们就不介绍其在排序中的应用了。</p>
<p>Java容器中有一个类PriorityQueue，就表示优先级队列，它实现了堆，下节我们会详细介绍。关于后面两个问题，它们是如何使用堆高效解决的，我们会在接下来的几节中用代码实现并详细解释。</p>
<h3 id="堆的概念"><a href="#堆的概念" class="headerlink" title="堆的概念"></a>堆的概念</h3><h4 id="完全二叉树"><a href="#完全二叉树" class="headerlink" title="完全二叉树"></a>完全二叉树</h4><p>堆首先是一颗二叉树，但它是完全二叉树。什么是完全二叉树呢？我们先来看另一个相似的概念，满二叉树。</p>
<p>满二叉树是指，除了最后一层外，每个节点都有两个孩子，而最后一层都是叶子节点，都没有孩子。</p>
<p>满二叉树一定是完全二叉树，但完全二叉树不要求最后一层是满的，但如果不满，则要求所有节点必须集中在最左边，从左到右是连续的，中间不能有空的。</p>
<h4 id="编号与数组存储"><a href="#编号与数组存储" class="headerlink" title="编号与数组存储"></a>编号与数组存储</h4><p>完全二叉树有一个重要的特点，给定任意一个节点，可以根据其编号直接快速计算出其父节点和孩子节点编号，如果编号为i，则父节点编号即为<code>i/2</code>，左孩子编号即为<code>2*i</code>,右孩子编号即为<code>2*i+1</code>。</p>
<p>这个特点为什么重要呢？它使得逻辑概念上的二叉树可以方便的存储到数组中，数组中的元素索引就对应节点的编号，树中的父子关系通过其索引关系隐含维持，不需要单独保持。</p>
<p>这种存储二叉树的方法与之前介绍的TreeMap是不一样的，在TreeMap中，有一个单独的内部类Entry，Entry有三个引用，分别指向父节点、左孩子、右孩子。</p>
<p>使用数组存储，优点是很明显的，节省空间，访问效率高。</p>
<h4 id="最大堆-最小堆"><a href="#最大堆-最小堆" class="headerlink" title="最大堆/最小堆"></a>最大堆/最小堆</h4><p>堆逻辑概念上是一颗完全二叉树，而物理存储上使用数组，除了这两点，堆还有一定的顺序要求。</p>
<p>对于排序二叉树，排序二叉树是完全有序的，每个节点都有确定的前驱和后继，而且不能有重复元素。</p>
<p>与排序二叉树不同，在堆中，可以有重复元素，元素间不是完全有序的，但对于父子节点之间，有一定的顺序要求，根据顺序分为两种堆，一种是最大堆，另一种是最小堆。</p>
<p>最大堆是指，每个节点都不大于其父节点。这样，对每个父节点，一定不小于其所有孩子节点，而根节点就是所有节点中最大的，对每个子树，子树的根也是子树所有节点中最大的。</p>
<p>最小堆与最大堆正好相反，每个节点都不小于其父节点。这样，对每个父节点，一定不大于其所有孩子节点，而根节点就是所有节点中最小的，对每个子树，子树的根也是子树所有节点中最小的。</p>
<h4 id="概念总结"><a href="#概念总结" class="headerlink" title="概念总结"></a>概念总结</h4><p>逻辑概念上，堆是完全二叉树，父子节点间有特定顺序，分为最大堆和最小堆，最大堆根是最大的，最小堆根是最小的，堆使用数组进行物理存储。</p>
<h3 id="堆的算法"><a href="#堆的算法" class="headerlink" title="堆的算法"></a>堆的算法</h3><p>我们用最小堆说明</p>
<h4 id="添加元素"><a href="#添加元素" class="headerlink" title="添加元素"></a>添加元素</h4><p>如果堆为空，则直接添加一个根就行了。我们假定已经有一个堆了，要在其中添加元素。基本步骤为：</p>
<ol>
<li>添加元素到最后位置。</li>
<li>与父节点比较，如果大于等于父节点，则满足堆的性质，结束，否则与父节点进行交换，然后再与父节点比较和交换，直到父节点为空或者大于等于父节点。</li>
</ol>
<p>从以上过程可以看出，添加一个元素，需要比较和交换的次数最多为树的高度，即log2(N)，N为节点数。</p>
<p>这种自低向上比较、交换，使得树重新满足堆的性质的过程，我们称之为<strong>siftup</strong>。</p>
<h4 id="从头部删除元素"><a href="#从头部删除元素" class="headerlink" title="从头部删除元素"></a>从头部删除元素</h4><p>在队列中，一般是从头部删除元素，Java中用堆实现优先级队列，我们来看下如何在堆中删除头部，其基本步骤为：</p>
<ol>
<li>用最后一个元素替换头部元素，并删掉最后一个元素。</li>
<li>将新的头部与两个孩子节点中较小的比较，如果不大于该孩子节点，则满足堆的性质，结束，否则与较小的孩子进行交换，交换后，再与较小的孩子比较和交换，一直到没有孩子，或者不大于两个孩子节点。这个过程我们般称为<strong>siftdown</strong>。</li>
</ol>
<h4 id="从中间删除元素"><a href="#从中间删除元素" class="headerlink" title="从中间删除元素"></a>从中间删除元素</h4><p>那如果需要从中间删除某个节点呢？与从头部删除一样，都是先用最后一个元素替换待删元素。不过替换后，有两种情况，如果该元素大于某孩子节点，则需向下调整(siftdown)，否则，如果小于父节点，则需向上调整(siftup)。</p>
<h4 id="构建初始堆"><a href="#构建初始堆" class="headerlink" title="构建初始堆"></a>构建初始堆</h4><p>给定一个无序数组，如何使之成为一个最小堆呢？将普通无序数组变为堆的过程我们称之为heapify。</p>
<p>基本思路是，从最后一个非叶子节点开始，一直往前直到根，对每个节点，执行向下调整siftdown。换句话说，是自底向上，先使每个最小子树为堆，然后每对左右子树和其父节点合并，调整为更大的堆，因为每个子树已经为堆，所以调整就是对父节点执行siftdown，就这样一直合并调整直到根。这个算法的伪代码是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">heapify</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=size/<span class="number">2</span>; i &gt;= <span class="number">1</span>; i--)</span><br><span class="line">        siftdown(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>size表示节点个数, 节点编号从1开始，size/2表示第一个非叶节点的编号。</p>
<p>这个构建的时间效率为O(N)，N为节点个数，具体就不证明了。</p>
<h4 id="查找和遍历"><a href="#查找和遍历" class="headerlink" title="查找和遍历"></a>查找和遍历</h4><p>在堆中进行查找没有特殊的算法，就是从数组的头找到尾，效率为O(N)。</p>
<p>在堆中进行遍历也是类似的，堆就是数组，堆的遍历就是数组的遍历，第一个元素是最大值或最小值，但后面的元素没有特定的顺序。</p>
<p>需要说明的是，如果是逐个从头部删除元素，堆可以确保输出是有序的。</p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p>以上就是堆操作的主要算法：</p>
<ul>
<li>在添加和删除元素时，有两个关键的过程以保持堆的性质，一个是向上调整(siftup)，另一个是向下调整(siftdown)，它们的效率都为O(log2(N))。由无序数组构建堆的过程heapify是一个自底向上循环的过程，效率为O(N)。</li>
<li>查找和遍历就是对数组的查找和遍历，效率为O(N)。</li>
</ul>
<p>堆是一种比较神奇的数据结构，概念上是树，存储为数组，父子有特殊顺序，根是最大值/最小值，构建/添加/删除效率都很高，可以高效解决很多问题。</p>
</div><div class="tags"><a href="/tags/Java/">Java</a></div><div class="post-nav"><a class="pre" href="/2017/11/18/Java基础/动态代理/">动态代理</a><a class="next" href="/2017/11/18/Java基础/红黑树/">红黑树</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var gitment = new Gitment({
  owner: 'wtksana',
  repo: 'wtksana.github.io',
  oauth: {
    client_id: '3337687b3c13cd764c2a',
    client_secret: '524f7e3efacf27d6614a5f2a9f623f8753a84eb5',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="wtksana.github.io"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java基础/">Java基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java相关/">Java相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/">Mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Others/">Others</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/IDEA/" style="font-size: 15px;">IDEA</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/ZooKeeper/" style="font-size: 15px;">ZooKeeper</a> <a href="/tags/MQ/" style="font-size: 15px;">MQ</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Centos/" style="font-size: 15px;">Centos</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/Https/" style="font-size: 15px;">Https</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/VPS/" style="font-size: 15px;">VPS</a> <a href="/tags/SS/" style="font-size: 15px;">SS</a> <a href="/tags/Jenkins/" style="font-size: 15px;">Jenkins</a> <a href="/tags/协议/" style="font-size: 15px;">协议</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/IP/" style="font-size: 15px;">IP</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/03/09/Mysql/Mysql用户相关/">Mysql用户相关</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/09/Java相关/redis骚操作/">Redis进阶命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/07/其他/Jenkins安装配置+部署SpringBoot/">Jenkins安装配置+部署SpringBoot</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/07/其他/各环境变量配置/">各环境变量配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/04/其他/互联网协议入门/">互联网协议入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/05/Java基础/Java 8 并发 Threads 和 Executors/">Java 8 并发 Threads 和 Executors</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/01/其他/SpringBoot使用IDEA远程debug/">SpringBoot使用IDEA远程debug</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/01/其他/SpringBoot+Nginx+Https/">阿里云+Https+Nginx+SpringBoot</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/26/其他/VPS安装SSR和BBR/">VPS安装SSR和BBR</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/03/其他/Centos通过yum安装mysql/">Centos通过yum安装mysql</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">tt_study.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>